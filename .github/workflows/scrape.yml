name: Scrape tides and deploy

on:
  schedule:
    - cron: "0 */3 * * *" # alle 3 Stunden
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ Repo auschecken
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ Node.js einrichten (verwende 20.x)
      - name: Set up Node.js
  uses: actions/setup-node@v4
  with:
    node-version: 20


      # 3Ô∏è‚É£ Dependencies installieren (inkl. cheerio)
      - name: Install dependencies
        run: |
          npm ci
          npm install cheerio@1.0.0-rc.12

      # 4Ô∏è‚É£ Tide-Daten abrufen und JSON erzeugen
      - name: Run tide fetch script
        run: |
          echo "üåä Lade Gezeiten f√ºr Playa del Ingl√©s ..."
          node scripts/fetch.js

      # 5Ô∏è‚É£ Frontend & Daten in den Ver√∂ffentlichungsordner kopieren
      - name: Copy frontend & data to public
        run: |
          mkdir -p public
          cp -r frontend/* public/
          echo "‚úÖ Frontend nach /public kopiert."

      # 6Ô∏è‚É£ Deployment zu GitHub Pages
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public
          force_orphan: true

      # 7Ô∏è‚É£ Abschluss
      - name: Deployment complete
        run: echo "üöÄ Gezeiten erfolgreich aktualisiert und ver√∂ffentlicht!"
