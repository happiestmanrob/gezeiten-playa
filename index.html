<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gezeiten ¬∑ Playa del Ingl√©s</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #e8f5ff;
      margin: 0;
      padding: 1rem;
      text-align: center;
    }
    main {
      background: white;
      border-radius: 20px;
      padding: 1.5rem;
      max-width: 420px;
      margin: auto;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    h1 {
      font-size: 1.9rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
      line-height: 1.2;
      white-space: nowrap;
    }
    @media (max-width: 600px) {
      h1 {
        font-size: 1.35rem;
        white-space: nowrap;
      }
      footer {
        font-size: 0.65rem;
      }
    }
    .trend {
      font-size: 1.5rem;
      margin: 0.2rem 0;
    }
    .falling { color: #d00; }
    .rising { color: #008000; }

    .days {
      margin: 0.6rem 0;
    }
    .days button {
      border: 1px solid #bbb;
      border-radius: 8px;
      background: #f5f5f5;
      margin: 2px;
      padding: 5px 10px;
      cursor: pointer;
    }
    .days button.active {
      background: #0078ff;
      color: white;
    }
    .dropdown {
      margin-top: 0.5rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 0.8rem;
      text-align: center;
    }
    th, td {
      padding: 0.5rem;
    }
    tr:not(:last-child) td {
      border-bottom: 1px solid #eee;
    }
    .low { color: red; }
    .high { color: green; }

    footer {
      font-size: 0.75rem;
      color: #777;
      margin-top: 1rem;
    }
    .sunmoon {
      margin-top: 1rem;
      font-size: 0.85rem;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    .sunmoon div {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .spring {
      color: #0057ff;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <main>
    <h1>üåä Gezeiten ¬∑ Playa del Ingl√©s</h1>
    <p id="date"></p>
    <div id="trend" class="trend"></div>
    <div class="days">
      <button id="todayBtn">Heute</button>
      <button id="tomorrowBtn">Morgen</button>
      <button id="dayAfterBtn">√úbermorgen</button>
    </div>
    <div class="dropdown">
      <select id="daySelect"></select>
    </div>
    <table id="tides">
      <thead>
        <tr><th>Zeit</th><th>Typ</th><th>H√∂he (m)</th></tr>
      </thead>
      <tbody></tbody>
    </table>

    <div id="sunmoon" class="sunmoon"></div>
    <footer id="footer"></footer>
  </main>

  <script>
    async function loadTides() {
      const res = await fetch("latest.json");
      const data = await res.json();
      const days = data.days;

      const today = new Date();
      const todayStr = today.toISOString().split("T")[0];

      const dateEl = document.getElementById("date");
      const trendEl = document.getElementById("trend");
      const tbody = document.querySelector("#tides tbody");
      const footer = document.getElementById("footer");
      const select = document.getElementById("daySelect");
      const sunmoonEl = document.getElementById("sunmoon");

      days.forEach((d, i) => {
        const dateObj = new Date(d.date.replace(/[^0-9\-]/g, ""));
        const option = document.createElement("option");
        option.value = i;
        option.textContent = dateObj.toLocaleDateString("de-DE");
        if (d.springTide) {
          option.style.color = d.moonPhase.includes("Full") ? "blue" : "deepskyblue";
        }
        select.appendChild(option);
      });

      function render(dayIndex) {
        const d = days[dayIndex];
        dateEl.textContent = d.date;
        tbody.innerHTML = "";
        d.entries.forEach(e => {
          const tr = document.createElement("tr");
          const cls = e.type.toLowerCase().includes("low") ? "low" : "high";
          tr.innerHTML = `<td>${e.time}</td><td class="${cls}">${e.type}</td><td>${e.height}</td>`;
          tbody.appendChild(tr);
        });

        // Trend bestimmen
        const nextLow = d.entries.find(e => e.type.toLowerCase().includes("low"));
        const nextHigh = d.entries.find(e => e.type.toLowerCase().includes("high"));
        if (nextLow && nextHigh) {
          trendEl.innerHTML = d.entries[0].type.toLowerCase().includes("low")
            ? '<div class="falling">‚¨áÔ∏è</div><div class="falling">Das Wasser f√§llt<br>(n√§chstes Niedrigwasser um ' + nextLow.time + ')</div>'
            : '<div class="rising">‚¨ÜÔ∏è</div><div class="rising">Das Wasser steigt<br>(n√§chstes Hochwasser um ' + nextHigh.time + ')</div>';
        }

        // Sonne & Mond
        sunmoonEl.innerHTML = `
          <div>üåÖ <strong>Auf:</strong> ${d.sunrise || "‚Äì"}</div>
          <div>üåá <strong>Unter:</strong> ${d.sunset || "‚Äì"}</div>
          <div>üåô <strong>Auf:</strong> ${d.moonrise || "‚Äì"}</div>
          <div>üåò <strong>Unter:</strong> ${d.moonset || "‚Äì"}</div>
          <div>${d.moonPhase ? "üåî " + d.moonPhase : ""}${d.springTide ? ' <span class="spring">(Springflut)</span>' : ""}</div>
        `;

        footer.textContent = `Quelle: tide-forecast.com ¬∑ Aktualisiert: ${new Date(data.updated).toLocaleString("de-DE", { timeZone: "Atlantic/Canary" })}`;
      }

      select.addEventListener("change", e => render(e.target.value));
      document.getElementById("todayBtn").onclick = () => render(0);
      document.getElementById("tomorrowBtn").onclick = () => render(1);
      document.getElementById("dayAfterBtn").onclick = () => render(2);

      render(0);
    }

    loadTides();
  </script>
</body>
</html>
