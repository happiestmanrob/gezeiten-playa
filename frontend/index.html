<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gezeiten ¬∑ Playa del Ingl√©s</title>
  <style>
    body {
      font-family: "Inter", system-ui, sans-serif;
      background-color: #eaf5ff;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    .card {
      background: white;
      padding: 1.5rem 2rem;
      border-radius: 1.5rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      text-align: center;
      max-width: 500px;
      margin-top: 1.5rem;
      width: 90%;
    }

    h1 {
      font-size: 1.8rem;
      margin-bottom: 0.25rem;
    }

    h2 {
      font-size: 1rem;
      color: #666;
      margin-top: 0;
      margin-bottom: 0.8rem;
    }

    .status {
      margin: 0.5rem 0 1rem;
    }

    .status span {
      display: block;
      font-weight: bold;
      font-size: 1.1rem;
    }

    button {
      border: 1px solid #ccc;
      background: white;
      padding: 0.4rem 1rem;
      border-radius: 0.5rem;
      margin: 0.2rem;
      cursor: pointer;
      transition: 0.2s;
      font-weight: 500;
    }

    button.active {
      background: #2563eb;
      color: white;
      border-color: #2563eb;
    }

    select {
      margin: 0.2rem;
      padding: 0.4rem;
      border-radius: 0.5rem;
      border: 1px solid #ccc;
      font-size: 0.95rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 0.8rem;
      font-size: 0.95rem;
    }

    th {
      color: #666;
      padding-bottom: 0.4rem;
    }

    td {
      padding: 0.4rem 0;
    }

    .hoch {
      color: #008000;
      font-weight: 600;
    }

    .niedrig {
      color: #d11a2a;
      font-weight: 600;
    }

    footer {
      font-size: 0.8rem;
      color: #777;
      margin-top: 0.8rem;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>üåä Gezeiten ¬∑ Playa del Ingl√©s</h1>
    <h2 id="dateHeading">‚Äì</h2>

    <div class="status">
      <div id="arrow" style="font-size: 1.8rem;">‚¨ÜÔ∏è</div>
      <span id="statusText">Das Wasser steigt</span>
      <div id="nextEvent">(n√§chstes Hochwasser um ‚Äì:‚Äì)</div>
    </div>

    <div>
      <button id="heute">Heute</button>
      <button id="morgen">Morgen</button>
      <button id="uebermorgen">√úbermorgen</button>
      <select id="dateSelect"></select>
    </div>

    <table id="tideTable">
      <thead>
        <tr><th>Zeit</th><th>Typ</th><th>H√∂he (m)</th></tr>
      </thead>
      <tbody></tbody>
    </table>

    <footer>
      Quelle: tide-forecast.com
    </footer>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const heuteButton = document.getElementById("heute");
      const morgenButton = document.getElementById("morgen");
      const uebermorgenButton = document.getElementById("uebermorgen");
      const dateSelect = document.getElementById("dateSelect");
      const tableBody = document.querySelector("#tideTable tbody");

      if (!heuteButton || !morgenButton || !uebermorgenButton || !dateSelect) {
        console.error("‚ùå Elemente nicht gefunden ‚Äì HTML pr√ºfen!");
        return;
      }

      // Lade gespeicherte Daten
      fetch("data/latest.json")
        .then((r) => r.json())
        .then((data) => {
          window.tideData = data.days || [];
          fillDropdown(window.tideData);
          showTides(0);
        })
        .catch((err) => {
          console.error("Fehler beim Laden der Daten:", err);
          tableBody.innerHTML = `<tr><td colspan="3">‚ùå Keine Daten gefunden.</td></tr>`;
        });

      heuteButton.onclick = () => showTides(0);
      morgenButton.onclick = () => showTides(1);
      uebermorgenButton.onclick = () => showTides(2);
      dateSelect.onchange = () => showTides(dateSelect.selectedIndex);

      function fillDropdown(days) {
        dateSelect.innerHTML = "";
        days.forEach((day) => {
          const opt = document.createElement("option");
          opt.textContent = formatGermanDate(day.date);
          dateSelect.appendChild(opt);
        });
      }

      function showTides(index) {
        if (!window.tideData || !window.tideData[index]) return;

        const { date, entries } = window.tideData[index];
        document.getElementById("dateHeading").textContent = formatGermanDate(date);
        dateSelect.selectedIndex = index;

        // Button-Stil aktualisieren
        [heuteButton, morgenButton, uebermorgenButton].forEach((b) => b.classList.remove("active"));
        [heuteButton, morgenButton, uebermorgenButton][index]?.classList.add("active");

        // Tabelleninhalt erstellen
        tableBody.innerHTML = entries.map((tide) => {
          const typeClass = tide.type.toLowerCase().includes("hoch") ? "hoch" : "niedrig";
          const height = convertToMeters(tide.height);
          return `<tr>
                    <td>${tide.time}</td>
                    <td class="${typeClass}">${tide.type}</td>
                    <td>${height}</td>
                  </tr>`;
        }).join("");

        // Status oben aktualisieren
        const nextHigh = entries.find(e => e.type.toLowerCase().includes("hoch"));
        if (nextHigh) {
          document.getElementById("arrow").textContent = "‚¨ÜÔ∏è";
          document.getElementById("statusText").textContent = "Das Wasser steigt";
          document.getElementById("nextEvent").textContent = `(n√§chstes Hochwasser um ${nextHigh.time})`;
        } else {
          document.getElementById("arrow").textContent = "‚¨áÔ∏è";
          document.getElementById("statusText").textContent = "Das Wasser f√§llt";
          document.getElementById("nextEvent").textContent = "(n√§chstes Niedrigwasser unbekannt)";
        }
      }

      function formatGermanDate(dateStr) {
        try {
          const d = new Date(dateStr);
          return d.toLocaleDateString("de-DE", { weekday: "long", day: "numeric", month: "long", year: "numeric" });
        } catch {
          return dateStr;
        }
      }

      function convertToMeters(str) {
        if (!str) return "-";
        const ftMatch = str.match(/([\d.,]+)/);
        if (!ftMatch) return str;
        const ft = parseFloat(ftMatch[1].replace(",", "."));
        const meters = ft * 0.3048;
        return meters.toFixed(2).replace(".", ",");
      }
    });
  </script>
</body>
</html>
