<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gezeiten · Playa del Inglés</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1:#e8f0ff; --bg2:#dff7ef;
      --card:#ffffff; --muted:#667085;
      --hi:#16a34a20; --lo:#ef444420;
      --pill:#f1f5f9; --ring:#e2e8f0;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto;
      background:radial-gradient(1200px 600px at 20% 10%,var(--bg1),transparent) no-repeat,
                 radial-gradient(1200px 600px at 80% 90%,var(--bg2),transparent) no-repeat,
                 #f6fbff;
      color:#0f172a;
      display:flex; align-items:flex-start; justify-content:center;
    }
    .wrap{width:100%; max-width:980px; padding:48px 16px}
    .card{
      background:var(--card); border:1px solid var(--ring);
      border-radius:18px; padding:28px 28px 8px; box-shadow:0 20px 40px rgba(2,6,23,.06);
    }
    h1{margin:0 0 6px; font-size:26px}
    .meta{color:var(--muted); font-size:14px; margin-bottom:6px}
    .date{font-weight:700; text-align:center; margin:16px 0 6px}
    .trend{
      text-align:center; color:#0f172a; font-weight:600; margin:0 0 14px;
    }
    table{width:100%; border-collapse:collapse; margin-top:6px}
    th,td{padding:14px 12px; border-bottom:1px solid var(--ring); text-align:left}
    th{font-size:14px; color:var(--muted); font-weight:600}
    .badge{
      display:inline-block; padding:4px 10px; border-radius:9999px; font-weight:600; font-size:12px;
    }
    .high{background:var(--hi); color:#166534}
    .low{background:var(--lo); color:#9a3412}
    .src{font-size:12px; color:var(--muted); text-align:center; margin:18px 0 10px}
    .jsonlink{float:right; font-size:13px}
    @media (max-width:640px){ th,td{padding:10px 8px} .wrap{padding:32px 12px} }
  </style>
</head>
<body>
  <main class="wrap">
    <section class="card">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
        <div>
          <h1>🌊 Gezeiten · Playa del Inglés</h1>
<p id="dateLabel" style="font-weight: 600;"></p>
<p id="trend" style="margin-top: 0.3em; font-size: 1.1em;"></p>

<table>
  <thead>
    <tr>
      <th>Zeit</th>
      <th>Typ</th>
      <th>Höhe (m)</th>
    </tr>
  </thead>
  <tbody id="tbody"></tbody>
</table>

<p id="source" style="margin-top: 1em; font-size: 0.85em; color: #666;"></p>

      <div class="src" id="source"> </div>
    </section>
  </main>

 <script>
const TZ = "Atlantic/Canary";

function tLocal(iso) {
  try {
    return new Date(iso).toLocaleTimeString("de-DE", { 
      timeZone: TZ, 
      hour: "2-digit", 
      minute: "2-digit" 
    });
  } catch { 
    return "–"; 
  }
}

function tDate(iso) {
  return new Date(iso).toLocaleDateString("de-DE", {
    weekday: "long",
    day: "2-digit",
    month: "long",
    year: "numeric",
    timeZone: TZ
  });
}

function renderDay(j) {
  const today = new Date().toLocaleDateString("en-CA", { timeZone: TZ });
  const dateEl = document.getElementById("dateLabel");
  const trendEl = document.getElementById("trend");
  const tb = document.getElementById("tbody");

  dateEl.textContent = tDate(j.meta.generatedAt);
  tb.innerHTML = "";

  (j.tides || []).forEach(e => {
    const badge = e.type === "High"
      ? "<span class='badge high'>Hochwasser</span>"
      : "<span class='badge low'>Niedrigwasser</span>";
    tb.innerHTML += `
      <tr>
        <td>${e.timeStr}</td>
        <td>${badge}</td>
        <td>${(e.height ?? 0).toFixed(2)}</td>
      </tr>`;
  });

  // Trend bestimmen (steigend oder fallend)
  const now = new Date(new Date().toLocaleString("en-US", { timeZone: TZ }));
  const next = j.tides.find(t => new Date(t.iso) > now);
  const prev = j.tides.slice().reverse().find(t => new Date(t.iso) <= now);
  let trendTxt = "–";
  let trendColor = "black";

  if (next && prev) {
    const rising = prev.type === "Low" && next.type === "High";
    const falling = prev.type === "High" && next.type === "Low";
    if (rising) {
      trendTxt = `Das Wasser steigt (nächstes Hochwasser um ${next.timeStr} Uhr)`;
      trendColor = "green";
    } else if (falling) {
      trendTxt = `Das Wasser fällt (nächstes Niedrigwasser um ${next.timeStr} Uhr)`;
      trendColor = "red";
    }
  }

  trendEl.textContent = trendTxt;
  trendEl.style.color = trendColor;

  document.getElementById("source").textContent =
    `Quelle: tide-forecast.com (geparst) · Aktualisiert ${new Date(j.meta.generatedAt).toLocaleString("de-DE", { timeZone: TZ })}`;
}

// 🔁 Lädt Daten für bestimmten Tag (heute, morgen, übermorgen)
async function loadDay(offset = 0) {
  const res = await fetch(`data.json?cb=${Date.now()}`);
  const j = await res.json();

  // aktuell nur heutiger Tag verfügbar:
  // du könntest später fetch.js erweitern, um mehrere Tage zu speichern
  renderDay(j);
}

loadDay();
</script>

</body>
</html>
